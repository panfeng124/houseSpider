<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECharts 示例</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
    <style>
        /* 设置图表容器全屏 */
        #chart {
            width: 100%;
            height: 100vh;  /* 100% 的视口高度 */
        }
    </style>
</head>
<body>
<div id="chart"></div>

<script>
    // 假设你将 'filtered_data.json' 放置在本地或者服务器上
    fetch('filtered_data.json')
        .then(response => response.json())
        .then(data => {
            // 确保交易时间被正确解析为 Date 对象
            data.forEach(item => {
                item['交易时间'] = new Date(item['交易时间']);  // 确保交易时间为 Date 类型
                item['交易时间'] = item['交易时间'].toISOString().split('T')[0];  // 转换为 'YYYY-MM-DD' 格式
            });

            // 确保按交易时间升序排序
            data.sort((a, b) => new Date(a['交易时间']) - new Date(b['交易时间']));

            var chart = echarts.init(document.getElementById('chart'));

            // 获取所有楼盘名字（确保每个楼盘是独立的系列）
            const buildingNames = [...new Set(data.map(item => item['楼盘名字']))];

            const seriesData = buildingNames.map(building => {
                return {
                    name: building,  // 楼盘名字作为系列名称
                    type: 'line',     // 线图
                    data: data.filter(item => item['楼盘名字'] === building)
                        .map(item => item['每平方米价格']),  // 每平方米价格作为 y 轴数据
                };
            });

            const option = {
                title: {
                    text: '各楼盘每平方米价格趋势'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: buildingNames  // 显示所有楼盘名字的图例
                },
                xAxis: {
                    type: 'category',
                    data: data.map(item => item['交易时间']), // 使用交易时间作为 x 轴数据
                    axisLabel: {
                        rotate: 45  // 旋转 X 轴标签，避免重叠
                    },
                    axisTick: {
                        alignWithLabel: true
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '每平方米价格'
                },
                series: seriesData  // 动态生成每个楼盘的系列
            };

            chart.setOption(option);

            // 响应式调整图表大小
            window.addEventListener('resize', function() {
                chart.resize();  // 窗口调整时重新调整图表大小
            });
        })
        .catch(err => console.error('数据加载错误：', err));
</script>
</body>
</html>
